<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <script>
const API_BASE_URL = "http://localhost:3001";
window.API_BASE = API_BASE_URL + "/api";
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ø­Ø§Ø¯Ø«Ø© - Ø£Ù†Ø§ Ù…Ø±ÙŠØ¶ Ø³ÙƒØ±ÙŠ</title>
  <link rel="stylesheet" href="../assets/css/patient-dashboard.css">
  <link rel="stylesheet" href="../assets/css/search.css">
  <link rel="stylesheet" href="../shared/chat.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="settings.js" defer></script>
</head>
<body>
  <header class="pd-header">
    <div class="pd-header-inner">
      <div class="pd-left">
        <a href="/" class="logo">Ø£Ù†Ø§ Ù…Ø±ÙŠØ¶ Ø³ÙƒØ±ÙŠ</a>
      </div>
      <div class="pd-center">
        <button class="icon-btn search-btn" aria-label="Ø¨Ø­Ø«">ğŸ”</button>
      </div>
      <div class="pd-right">
        <button class="icon-btn chat-btn" id="chatBtn" aria-label="Ù…Ø­Ø§Ø¯Ø«Ø©" title="Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¨">ğŸ’¬</button>
       
        </div>
       
      </div>
    </div>
  </header>

  <main class="pd-main">
    <aside class="pd-sidebar">
      <nav class="pd-nav" aria-label="Patient navigation">
        <ul>
          <li data-nav="daily"><span class="mc-icon">ğŸ©º</span> <span class="mc-title">Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</span></li>
          <li data-nav="history"><span class="mc-icon">ğŸ“„</span> <span class="mc-title">Ø³Ø¬Ù„ Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©</span></li>
          <li data-nav="appointments"><span class="mc-icon">ğŸ“…</span> <span class="mc-title">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</span></li>
          <li data-nav="prescriptions"><span class="mc-icon">ğŸ’Š</span> <span class="mc-title">Ø§Ù„ÙˆØµÙØ§Øª</span></li>
          <li data-nav="labs"><span class="mc-icon">ğŸ”¬</span> <span class="mc-title">Ø§Ù„Ù…Ø®ØªØ¨Ø±</span></li>
          <li data-nav="carb"><span class="mc-icon">ğŸ</span> <span class="mc-title">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª</span></li>
          <li data-nav="personal-settings">
            <span class="mc-icon">âš™ï¸</span>
            <span class="mc-title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</span>
          </li>
        </ul>
      </nav>
    </aside>

    <section class="pd-content">
      <div id="chatContainer"></div>
    </section>
  </main>


  <script src="../assets/js/main.js"></script>
  <script src="../assets/js/auth-guard.js"></script>
  <script src="../shared/chat.js"></script>
  <script src="../assets/js/search.js"></script>
  <script>
    // Auth guard for patient
    (function() {
      const token = localStorage.getItem('authToken') || localStorage.getItem('auth_token');
      const role = localStorage.getItem('userRole');
      if (!token || role !== 'patient') {
        window.location.href = '../login.html';
        return;
      }
    })();
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof ChatManager === 'undefined') {
        document.getElementById('chatContainer').innerHTML = '<div style="padding: 20px; color: red;">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©: ChatManager is not defined</div>';
        return;
      }
      try {
        window.chatManager = new ChatManager('chatContainer', 'patient');
        console.log('ØªÙ… Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù…Ø±ÙŠØ¶');
      } catch (error) {
        console.error('ØªØ¹Ø°Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©:', error);
        document.getElementById('chatContainer').innerHTML = 
          '<div style="padding: 20px; color: red;">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©: ' + error.message + '</div>';
      }
    });
  </script>
</body>
</html>